<div class="grid">
  <div class="col-12 md:col-4">
    <div class="surface-card shadow-2 p-3 border-round">
      <div class="flex justify-content-between mb-3">
        <div>
          <span class="block text-500 font-medium mb-3">{{
            I18N.DASHBOARD.KPI.TOTAL_LEADS
          }}</span>

          <div class="text-900 font-medium text-xl">
            {{ metrics().totalLeads }}
          </div>
        </div>
        <div
          class="flex align-items-center justify-content-center bg-blue-100 border-round w-3rem h-3rem"
        >
          <i class="pi pi-users text-blue-500 text-xl"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 md:col-4">
    <div class="surface-card shadow-2 p-3 border-round">
      <div class="flex justify-content-between mb-3">
        <div>
          <span class="block text-500 font-medium mb-3">{{
            I18N.LEAD.PROPERTIES.AREA_LABEL
          }}</span>

          <div class="text-900 font-medium text-xl">
            {{
              geoStats()?.totalAreaRegistered || metrics().totalArea | number
            }}
          </div>
        </div>
        <div
          class="flex align-items-center justify-content-center bg-orange-100 border-round w-3rem h-3rem"
        >
          <i class="pi pi-map text-orange-500 text-xl"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 md:col-4">
    <div class="surface-card shadow-2 p-3 border-round">
      <div class="flex justify-content-between mb-3">
        <div>
          <span class="block text-500 font-medium mb-3">{{
            I18N.DASHBOARD.KPI.ESTIMATED_POTENTIAL
          }}</span>

          <div class="text-900 font-medium text-xl">
            {{ metrics().totalPotential | currency: 'BRL' }}
          </div>
        </div>
        <div
          class="flex align-items-center justify-content-center bg-green-100 border-round w-3rem h-3rem"
        >
          <i class="pi pi-dollar text-green-500 text-xl"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 md:col-6">
    <div class="surface-card shadow-2 border-round p-4 h-full">
      <h5>{{ I18N.DASHBOARD.CHARTS.MARKET_SHARE }}</h5>
      @if (pieData()) {
        <p-chart
          type="pie"
          [data]="pieData()"
          [options]="chartOptions"
        ></p-chart>
      } @else {
        <div class="flex align-items-center justify-content-center h-15rem">
          <span class="text-500">{{ I18N.COMMON.NO_DATA }}</span>
        </div>
      }
    </div>
  </div>

  <div class="col-12 md:col-6">
    <div class="surface-card shadow-2 border-round p-4 h-full">
      <h5>{{ I18N.DASHBOARD.CHARTS.FORECAST }}</h5>
      @if (barData()) {
        <p-chart
          type="bar"
          [data]="barData()"
          [options]="chartOptions"
        ></p-chart>
      } @else {
        <div class="flex align-items-center justify-content-center h-15rem">
          <span class="text-500">{{ I18N.COMMON.NO_DATA }}</span>
        </div>
      }
    </div>
  </div>

  <div class="col-12 md:col-6">
    <div class="surface-card shadow-2 border-round p-4 h-full">
      <div class="flex align-items-center justify-content-between mb-3">
        <h5>{{ I18N.DASHBOARD.KPI.STALE_LEADS.TITLE }}</h5>
        <span class="text-500 text-sm"
          >{{ staleLeads().length }}
          {{ I18N.DASHBOARD.KPI.STALE_LEADS.FOUND }}</span
        >
      </div>
      <ul
        class="list-none p-0 m-0 overflow-y-auto"
        [ngStyle]="{ 'max-height': '20vh' }"
      >
        @for (lead of staleLeads(); track lead.id) {
          <li
            class="flex align-items-center justify-content-between py-2 border-bottom-1 surface-border"
          >
            <span class="text-900">{{ lead.name }}</span>
            <span class="text-600 text-sm"
              >{{ getDaysInactive(lead.updatedAt) }}
              {{ I18N.DASHBOARD.KPI.STALE_LEADS.INACTIVE_DAYS }}</span
            >
          </li>
        }
        @if (staleLeads().length === 0) {
          <li class="text-500 text-center py-2">
            {{ I18N.DASHBOARD.KPI.STALE_LEADS.FOUND }}
          </li>
        }
      </ul>
    </div>
  </div>

  <div class="col-12 md:col-6">
    <div class="surface-card shadow-2 border-round p-4 h-full">
      <h5>{{ I18N.DASHBOARD.KPI.PLANTING_ALERTS }}</h5>
      <div class="flex flex-wrap gap-2">
        @for (alert of plantingAlerts(); track alert.culture) {
          <p-tag
            [value]="alert.culture"
            severity="warn"
            icon="pi pi-exclamation-triangle"
          ></p-tag>
        }
        @if (plantingAlerts().length === 0) {
          <span class="text-500">{{
            I18N.DASHBOARD.KPI.PLANTING_ALERTS_EMPTY
          }}</span>
        }
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="surface-card shadow-2 border-round p-4">
      <h5>{{ I18N.DASHBOARD.SECTIONS.MAP_HEATMAP }}</h5>
      <app-heatmap-view [heatmapData]="heatmapData()"></app-heatmap-view>
    </div>
  </div>
</div>
