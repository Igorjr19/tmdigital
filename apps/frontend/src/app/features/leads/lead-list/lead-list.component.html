<div class="card p-3 surface-card border-round shadow-1">
  <p-toast></p-toast>
  <p-confirmDialog [style]="{ width: '50vw' }"></p-confirmDialog>

  <div class="flex justify-content-between align-items-center mb-3">
    <h2 class="m-0 text-900">{{ I18N.LEAD.LIST.TITLE }}</h2>
    <div class="flex gap-2">
      <p-button
        icon="pi pi-plus"
        [label]="I18N.LEAD.LIST.NEW_LEAD"
        severity="primary"
        (onClick)="createLead()"
      ></p-button>
    </div>
  </div>

  <p-table
    #dt
    [value]="leadsFacade.leads()"
    [lazy]="true"
    (onLazyLoad)="loadLeads($event)"
    [loading]="leadsFacade.loading()"
    [totalRecords]="leadsFacade.totalRecords()"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    styleClass="p-datatable-sm"
    [tableStyle]="{ 'min-width': '60rem' }"
  >
    <ng-template pTemplate="caption">
      <div class="flex align-items-center justify-content-between">
        <span
          class="flex align-items-center justify-content-between gap-4 p-input-icon-left w-full sm:w-auto"
        >
          <i class="pi pi-search text-500"></i>
          <input
            pInputText
            type="text"
            (input)="onSearch($event)"
            [placeholder]="I18N.COMMON.SEARCH"
            [value]="leadsFacade.searchQuery()"
            class="w-full"
          />
          <p-select
            [options]="statusOptions"
            [(ngModel)]="selectedStatus"
            (onChange)="onStatusChange($event.value)"
            optionLabel="label"
            optionValue="value"
            placeholder="Filtrar por Status"
            class="mr-2 min-w-[150px]"
          ></p-select>
        </span>
        <p-select
          [options]="sortOptions"
          [(ngModel)]="selectedSort"
          (onChange)="onSortChange($event.value)"
          optionLabel="label"
          optionValue="value"
          placeholder="Ordenar por"
          class="min-w-[200px]"
        ></p-select>
      </div>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th>{{ I18N.LEAD.LIST.HEADERS.NAME }}</th>
        <th>{{ I18N.LEAD.LIST.HEADERS.DOCUMENT }}</th>
        <th>{{ I18N.LEAD.LIST.HEADERS.STATUS }}</th>
        <th>{{ I18N.LEAD.LIST.HEADERS.POTENTIAL }}</th>
        <th class="text-center">{{ I18N.COMMON.ACTIONS }}</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-lead>
      <tr
        (click)="viewDetails(lead)"
        style="cursor: pointer"
        class="hover:surface-100 transition-colors transition-duration-200"
      >
        <td>{{ lead.name }}</td>
        <td>{{ lead.document | document }}</td>
        <td>
          <p-tag
            [value]="$any(I18N.LEAD.STATUS)[lead.status] || lead.status"
            [severity]="getSeverity(lead.status)"
          ></p-tag>
        </td>
        <td>{{ lead.estimatedPotential | currency: 'BRL' }}</td>
        <td class="text-center">
          <div class="flex gap-2 justify-content-center">
            <p-button
              icon="pi pi-pencil"
              [rounded]="true"
              [text]="true"
              severity="info"
              [pTooltip]="I18N.COMMON.EDIT"
              tooltipPosition="top"
              (onClick)="editLead(lead, $event)"
            ></p-button>
            <p-button
              icon="pi pi-trash"
              [rounded]="true"
              [text]="true"
              severity="danger"
              [pTooltip]="I18N.COMMON.DELETE"
              tooltipPosition="top"
              (onClick)="deleteLead(lead, $event)"
            ></p-button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6" class="text-center p-3">
          {{ I18N.LEAD.LIST.EMPTY }}
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
