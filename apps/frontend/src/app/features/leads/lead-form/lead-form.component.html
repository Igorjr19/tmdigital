<div class="surface-card p-4 shadow-2 border-round w-full lg:w-6 m-auto mt-4">
  <p-toast></p-toast>

  <div
    class="flex justify-content-between align-items-center mb-4 border-bottom-1 surface-border pb-3"
  >
    <h2 class="m-0 text-900 font-bold">
      {{ isEditMode() ? 'Editar Lead' : 'Novo Lead' }}
    </h2>
    <p-button
      icon="pi pi-arrow-left"
      label="Voltar"
      [text]="true"
      severity="secondary"
      (onClick)="goBack()"
    ></p-button>
  </div>

  <form
    [formGroup]="form"
    (ngSubmit)="onSubmit()"
    class="grid formgrid p-fluid"
  >
    <!-- Nome -->
    <div class="field col-12 md:col-6">
      <label for="name" class="font-medium text-900"
        >Nome <span class="text-red-500">*</span></label
      >
      <input
        id="name"
        type="text"
        pInputText
        formControlName="name"
        placeholder="Nome do Lead"
        class="w-full"
        [ngClass]="{
          'ng-invalid ng-dirty':
            form.get('name')?.invalid && form.get('name')?.dirty,
        }"
      />
      @if (form.get('name')?.invalid && form.get('name')?.dirty) {
        <small class="p-error block"> Nome é obrigatório. </small>
      }
    </div>

    <!-- Documento -->
    <div class="field col-12 md:col-6">
      <label for="document" class="font-medium text-900"
        >Documento <span class="text-red-500">*</span></label
      >
      <input
        id="document"
        type="text"
        pInputText
        formControlName="document"
        placeholder="CPF/CNPJ"
        class="w-full"
        [ngClass]="{
          'ng-invalid ng-dirty':
            form.get('document')?.invalid && form.get('document')?.dirty,
        }"
      />
      @if (form.get('document')?.invalid && form.get('document')?.dirty) {
        <small class="p-error block"> Documento é obrigatório. </small>
      }
    </div>

    <!-- Status -->
    <div class="field col-12 md:col-6">
      <label for="status" class="font-medium text-900"
        >Status <span class="text-red-500">*</span></label
      >
      <p-select
        id="status"
        [options]="statusOptions"
        formControlName="status"
        placeholder="Selecione..."
        optionLabel="label"
        optionValue="value"
        styleClass="w-full"
        appendTo="body"
      ></p-select>
    </div>

    <!-- Potencial -->
    <div class="field col-12 md:col-6">
      <label for="estimatedPotential" class="font-medium text-900"
        >Potencial (R$)</label
      >
      <p-inputNumber
        id="estimatedPotential"
        formControlName="estimatedPotential"
        mode="currency"
        currency="BRL"
        locale="pt-BR"
        placeholder="R$ 0,00"
        styleClass="w-full"
        class="w-full"
      ></p-inputNumber>
    </div>

    <!-- Fornecedor Atual -->
    <div class="field col-12">
      <label for="currentSupplier" class="font-medium text-900"
        >Fornecedor Atual</label
      >
      <span class="p-input-icon-left w-full">
        <i class="pi pi-briefcase"></i>
        <input
          id="currentSupplier"
          type="text"
          pInputText
          formControlName="currentSupplier"
          placeholder="Ex: Concorrente X"
          class="w-full"
        />
      </span>
    </div>

    <!-- Notas -->
    <div class="field col-12">
      <label for="notes" class="font-medium text-900">Observações</label>
      <textarea
        id="notes"
        pTextarea
        formControlName="notes"
        rows="4"
        placeholder="Observações adicionais..."
        class="w-full resize-none"
      ></textarea>
    </div>

    <!-- Botões -->
    <div
      class="col-12 flex justify-content-end gap-3 mt-4 pt-3 border-top-1 surface-border"
    >
      <p-button
        label="Cancelar"
        icon="pi pi-times"
        styleClass="p-button-outlined p-button-secondary"
        (onClick)="goBack()"
      ></p-button>
      <p-button
        label="Salvar"
        icon="pi pi-save"
        type="submit"
        [loading]="leadsFacade.loading()"
        [disabled]="form.invalid"
      ></p-button>
    </div>
  </form>

  @if (isEditMode() && leadId && lead()) {
    <div class="mt-4 pt-3 border-top-1 surface-border">
      <app-lead-properties
        [leadId]="leadId"
        [properties]="leadProperties"
      ></app-lead-properties>
    </div>
  }
</div>
